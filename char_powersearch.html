<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Character PowerSearch</title>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <style>.ui-menu.ui-widget.ui-widget-content{z-index:9999!important}</style>
  <style>
    :root{
      --bg:#0b0d10;--panel:#0f1318;--panel-2:#0c1117;--text:#e5e7eb;--muted:#97a3b5;--border:#1e293b;--accent:#7dd3fc;--accent-2:#a78bfa;--chip:#0f172a;--ok:#34d399
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:14px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:radial-gradient(1200px 800px at 80% -10%,#0f172a 0,#0b0d10 45%) fixed}
    a{color:inherit}

    /* LAYOUT */
    .app{display:grid;grid-template-rows:auto 1fr;min-height:100vh}
    header.appbar{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(11,13,16,.95),rgba(11,13,16,.85));backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
    .appbar-inner{display:grid;grid-template-columns:260px 1fr;gap:10px;padding:10px}
    .bar{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:10px}

    .content{display:grid;grid-template-columns:320px 1fr;gap:12px;padding:12px}
    aside.sidebar{display:grid;grid-auto-rows:max-content;gap:12px}
    main.stage{display:grid;grid-template-rows:auto 1fr;min-height:0; max-width:100%; overflow-x:hidden;}

    .section{background:var(--panel);border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .section header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:linear-gradient(180deg,rgba(17,21,27,.98),rgba(17,21,27,.92));border-bottom:1px solid var(--border)}
    .section header h3{margin:0;font-size:13px;letter-spacing:.02em}
    .micro{font-size:12px;color:var(--muted)}
    .body{padding:12px}

    /* controls */
    input[type="text"],textarea,select,input[type="number"],input[type="range"]{width:100%;background:#0b0f16;border:1px solid var(--border);color:var(--text);border-radius:8px;padding:8px 10px;outline:none}
    textarea{min-height:88px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
    .hint{font-size:12px;color:var(--muted)}
    .kbd{padding:1px 6px;border:1px solid var(--border);border-bottom-width:3px;border-radius:6px;background:#0b0f16;font-size:12px}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#0c1118}

    /* header widgets */
    .brand{display:flex;gap:8px;align-items:center}
    .logo{width:26px;height:26px;border-radius:6px;background:linear-gradient(135deg,#111827,#020617);border:1px solid #101827;display:grid;place-items:center;font-weight:700;color:var(--accent)}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .chip{background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:4px 8px;white-space:nowrap;font-family:ui-monospace,Menlo,Consolas}

    /* results */
    .results-head{position:sticky;top:0;z-index:1;background:linear-gradient(180deg,rgba(15,18,22,.96),rgba(15,18,22,.86));border-bottom:1px solid var(--border);padding:8px 12px}
    .metrics{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));gap:12px;padding:12px;align-content:start;align-items:start}
    .card{display:grid;grid-template-columns:84px 1fr;gap:10px;padding:10px;border:1px solid var(--border);border-radius:12px;background:#0c0f14}
    .avatar {
      width: 84px;
      height: 190px;
      display: grid;
      place-items: center;
      color: #94a3b8;
      font-size: 11px;
      background-size: contain;
      background-position: top;
      background-repeat: no-repeat;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      transform-origin: top left;
    }
    .avatar:hover {
      transform: scale(4.0);
      z-index: 910;
    }
    .meta{font-size:12px;color:#9aa6b2;display:flex;gap:10px;flex-wrap:wrap}
    .tags{font-size:12px;margin-top:6px;color:#cbd5e1}
    .tags .list{display:-webkit-box;-webkit-line-clamp:15;-webkit-box-orient:vertical;overflow:hidden}
    .card-actions{display:flex;gap:8px;margin-top:10px}
    .card-actions .btn{padding:6px 10px;font-size:13px;background-color: #0c263d;text-decoration: none;}

    /* footer bar inside header center column */
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .spacer{flex:1}
    .select{min-width:180px}

    /* placeholder "buttons" (no JS) */
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:#0b0f16}
    .btn[aria-disabled="true"]{opacity:.6}

  .snippet{
    /* 1) multi-line clamp with ellipsis */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 15;         /* change lines as you like */
    overflow: hidden;

    /* 2) break long words/URLs aggressively */
    overflow-wrap: anywhere;       /* modern: breaks anywhere if needed */
    word-wrap: break-word;         /* legacy alias */
    word-break: break-word;        /* chromium-friendly fallback */
    hyphens: auto;                 /* adds soft hyphens where possible */

    /* 3) better CJK handling (prevents overflow on long runs) */
    line-break: loose;
  }

  .ui-menu .ui-menu-item-wrapper{
    color:var(--muted)!important;
    background-color: var(--bg)!important;
  }

  /* Ensure anchors in snippets wrap too */
  .snippet a{
    overflow-wrap: anywhere;
    word-break: break-word;
    hyphens: auto;
    text-decoration: underline;    /* keep it obvious it’s a link */
  }

/* === add to your stylesheet === */

/* Card layout when showing avatar + buttons only */
.grid.avatar-only .card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  width: min(220px, 32vw);
}

/* Make the avatar bigger and centered */
.grid.avatar-only .card .avatar {
  width: 180px;           /* tweak to taste */
  height: 220px;
  border-radius: 14px;
  background-size: cover;
  background-position: center;
  box-shadow: 0 4px 18px rgba(0,0,0,.25);
}

/* Hide all the text blocks */
.grid.avatar-only .card h4,
.grid.avatar-only .card .meta,
.grid.avatar-only .card .tags,
.grid.avatar-only .card .snippet {
  display: none !important;
}

/* Keep the action buttons visible and centered under the image */
.grid.avatar-only .card .card-actions {
  display: flex;
  justify-content: center;
  gap: 6px;
  width: 100%;
  margin-top: 4px;
}

/* Optional: make buttons a bit tighter/wider for this mode */
.grid.avatar-only .card .card-actions .btn {
  padding: 6px 10px;
  min-width: 74px; /* so 'Similar'/'Details'/'Chat' feel balanced */
}

/* Existing hover effect (example) */
.grid .card:hover .avatar {
  transform: scale(1.05) translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,.35);
}

/* Override when avatar-only mode is on */
.grid.avatar-only .card:hover .avatar {
  transform: none !important;
  box-shadow: none !important;
  cursor: default; /* optional, makes it feel inert */
}

/* Let cards stretch in avatar-only mode */
.grid.avatar-only .card {
  width: 100% !important;   /* fill the grid cell */
  max-width: none;          /* remove hard cap if present */
}

/* Wider slots = bigger avatars/cards */
.grid.avatar-only {
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
}

/* Bigger avatar when cards are allowed to grow */
.grid.avatar-only .card .avatar {
  width: 100%;      /* span the card width */
  height: auto;     /* maintain aspect ratio if you like */
  aspect-ratio: 3/4; /* or fix ratio, e.g. portrait */
}

  </style>

  <style type="text/css" src="/css/jquery-ui.min.css"></style>
  <script src="/lib/jquery-3.5.1.min.js"></script>
  <script src="/lib/jquery-ui.min.js"></script>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header class="appbar">
      <div class="appbar-inner">
        <div class="bar brand">
          <div class="logo">PS</div>
          <div>
            <div style="font-weight:700;letter-spacing:.02em">Character PowerSearch</div>
            <div class="micro">Cards go brrrr.</div>
          </div>
        </div>
        <div class="bar">
          <div class="toolbar">
            <input type="text" placeholder="Search names / notes / description…" aria-label="search" />
            <div class="spacer"></div>
            <select class="select">
              <option>Name ↑ (A → Z)</option>
              <option>Name ↓ (Z → A)</option>
              <option>Tag Count ↑ (Smallest → Largest)</option>
              <option>Tag Count ↓ (Largest → Smallest)</option>
              <option>Rarity Σidf ↑ (Smallest → Largest)</option>
              <option>Rarity Σidf ↓ (Largest → Smallest)</option>
              <option>Favorites → First</option>
              <option>Favorites → Last</option>
              <option>Creator ↑ (A → Z)</option>
              <option>Creator ↓ (Z → A)</option>
              <option>Created Date ↑ (Oldest → Newest)</option>
              <option selected>Created Date ↓ (Newest → Oldest)</option>
              <option>Date Added ↑ (Oldest → Newest)</option>
              <option>Date Added ↓ (Newest → Oldest)</option>
              <option>Last Chat Date ↑ (Oldest → Newest)</option>
              <option>Last Chat Date ↓ (Newest → Oldest)</option>
              <option>Chat Size ↑ (Smallest → Largest)</option>
              <option>Chat Size ↓ (Largest → Smallest)</option>
              <option>Data Size ↑ (Smallest → Largest)</option>
              <option>Data Size ↓ (Largest → Smallest)</option>
            </select>
          </div>
        </div>
      </div>
    </header>

    <!-- BODY: SIDEBAR + RESULTS -->
    <div class="content">
      <!-- SIDEBAR -->
      <aside class="sidebar" aria-label="Filters">
        <section class="section">
          <header>
            <h3>Boolean rule</h3>
            <span class="micro">AND / OR / NOT</span>
          </header>
          <div class="body">
            <textarea spellcheck="false" placeholder='"Female" AND "Slice of Life" AND NOT Dominant'></textarea>
            <div class="hint" style="margin-top:6px">Tags with spaces must be quoted. Parentheses allowed.</div>
          </div>
        </section>

        <section class="section">
          <header>
            <h3>N from list</h3>
            <span class="micro">Keeps cards that match at least N of your picks</span>
          </header>
          <div class="body">
            <div class="row">
              <input type="text" placeholder='"Office", "Slice of Life", "Japan"' aria-label="tag bundle" />
              <input type="number" min="0" value="2" style="max-width:100px" aria-label="M" />
            </div>
            <div class="hint" style="margin-top:6px">keep if ≥ M of these tags are present.</div>
          </div>
        </section>

        <section class="section">
          <header>
            <h3>Frequency & rarity</h3>
            <span class="micro">Narrow by tag count / uncommon mix</span>
          </header>
          <div class="body">
            <div class="row"><label class="hint">Tag count range</label><span class="hint">k[char]</span></div>
            <div style="display:flex;gap:8px">
              <input type="range" min="0" max="256" value="0" aria-label="min tag count" />
              <input type="range" min="0" max="256" value="256" aria-label="max tag count" />
            </div>
            <div class="row" style="margin-top:8px"><label class="hint">Min rarity (Σidf)</label><span class="hint">uncommon → common</span></div>
            <input type="range" min="0" max="500" value="0" aria-label="min rarity" />
          </div>
        </section>

        <section class="section">
          <header>
            <h3>Weights (optional)</h3>
            <span class="micro">Affects sort only</span>
          </header>
          <div class="body">
            <input type="text" placeholder='weight("obscure-fetish") = 2.0; weight("Female") = 0.3' />
            <div class="hint" style="margin-top:6px">Score = Σ weight[tag∈card]; apply after filters.</div>
          </div>
        </section>

        <div id="finalSection">

        </div>

      </aside>

      <!-- RESULTS -->
      <main class="stage" aria-label="Results">
        <div class="results-head">
          <div class="metrics">
            <span class="chip">Candidates: 0</span>
            <span class="chip">After Boolean: 0</span>
            <span class="chip">After M from List: 0</span>
            <span class="chip">After Frequency: 0</span>
            <span class="chip">Sorted by: Tag Count ↓</span>
            <a href="#" class="micro" role="button">Reset filters</a>
          </div>
        </div>

        
<!-- Card template (not displayed) -->
<template id="card-template">
  <article class="card" role="listitem">
    <div class="avatar" data-avatar>84×84</div>
    <div>
      <h4 style="margin:2px 0 4px">
        <span data-name>—</span> <span class="micro">• id <span data-id>—</span></span>
      </h4>
      <div class="meta">
        <span>k=<span data-k>0</span></span>
        <span>Σidf=<span data-sigma>0</span></span>
        <span>score=<span data-score>0</span></span>
        <span class="micro" data-lastchat>Last chat: —</span>
      </div>
      <div class="tags">
        <span class="micro">Tags: </span>
        <span class="list" data-tags>—</span>
      </div>
      <p class="snippet" data-snippet>—</p>
      <div class="card-actions">
        <a href="#" class="btn" role="button"> View Similar</a>
        <a href="#" class="btn" role="button"> Start Chat</a>
      </div>
    </div>
  </article>
</template>

<div class="grid" role="list">


          <div class="sentinel" aria-hidden="true"></div>
        </div>


        </div>
      </main>
    </div>
  </div>
  <script type="module" src="./cards-backend.js"></script>
  <script type="module" src="./ui-wire.js"></script>

</body>
</html>
